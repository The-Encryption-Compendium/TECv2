# Development

TECv2 is a static site created using [Hugo](https://gohugo.io). The [original version of the site](https://github.com/The-Encryption-Compendium/the-encryption-compendium) was a Django-based dynamic site. At least for the moment, TECv2 has replaced it as a simpler and more easily deployable version of the site.

## Build process

This repository primarily contains various scripts, templates, and JS/CSS files. However, to get the site up and running, it must first be built using Hugo. Here is an overview of how the site is built (using [GitHub actions](.github/workflows/ghpages.yml)) whenever a new commit is pushed to `main`:

1. Compendium entries are downloaded from Zotero using the `deploy_tools/scrape_zotero.py` script and an API key for the research team's Zotero. There are stored in a BibTeX file, `data/data.bib`.
2. The BibTeX file is converted into JSON and stored in a JavaScript file, `assets/js/entries.js`. In addition, Markdown files are generated for every entry and stored in `content/entries/`. This process is controlled by `deploy_tools/generate_compendium.py`.
3. `hugo --minify` is run, generating the HTML, CSS, and JS files that are served by the site. These are stored in the `public/` directory.
4. Additional files are copied over from `deploy_tools/additional_files/` into the public directory, and `data/data.bib` is copied into `public/data/data.bib`.

The contents of the `public/` directory are then pushed to the [the-encryption-compendium.github.io repository](https://github.com/The-Encryption-Compendium/the-encryption-compendium.github.io), from which they are then used to serve the site.

## Running the site locally

After you clone and `cd` into this repository, there are two steps to start building the site and testing it locally:

- **Download Hugo:** [download the latest version of Hugo](https://github.com/gohugoio/hugo/releases) and place it somewhere on your system `PATH`. You may also pick one of the alternative installation methods described in the [Hugo manual](https://gohugo.io/getting-started/installing/), if you prefer.
- **Build locally**: finally, you have to step through the [build process](#build-process) in order to download all of the files you need to get the site running.

Once you've completed these steps, you can run the site by executing `hugo server` and then going to http://localhost:1313. HTML, CSS, and other files are saved to the `public/` directory while the site is running. As you modify files locally, your changes should be reflected in your local instance of the site.

## Directory structure

This repository contains the following top-level directories:

- `archetypes/`: contains [archetype templates](https://gohugo.io/content-management/archetypes/) for the site. Currently these are unused, although that is subject to change as more content is added to the site.
- `assets/`: SCSS and JavaScript files for the site. This is where custom stylesheets and scripts for the site should go. When the site is run, Hugo will concatenate and minify these files prior to serving them to the user.
- `content/`: contains Markdown files that are used to generate the pages of the site.
  - `content/entries/` contains all of the Markdown files for the compendium entries. The directory is left empty in the repository; during the build process, compendium entries are retrieved and stored as Markdown files in this directory. See the [Build Process](#build-process) section for more information.
- `data/`: this directory is empty in the repository. During the build process, a BibTeX file is generated from the research team's Zotero entries and placed in `data/data.bib`. This file is then used to generate all of the compendium entries in `content/entries/`.
- `deploy_tools/`: contains a variety of scripts that are used during the build and deployment process.
- `layouts/`: the [Hugo templates](https://gohugo.io/templates/) used for the site.
- `static/`: contains various static files used by the site.

In addition, the following directories are generated by the build process, but ignored by the repository:

- `public/`: contains the HTML, CSS, and JS files that are actually served to users.
- `resources/`: created when running `hugo server`. This directory caches some files to help increase the site's build speed.

